@page "/settings"
@using BrothersEnglishApp.Models
@using BrothersEnglishApp.Services
@inject LocalStorageService Storage

<PageTitle>設定 - くんくん英単語</PageTitle>

<div class="container mt-4">
    <h3>⚙️ アプリの設定</h3>

    <div class="card shadow-sm mt-3">
        <div class="card-body">
            <h5 class="card-title">学習の設定</h5>
            <hr />
            <div class="form-group mb-3">
                <label class="form-label">一日の目標単語数</label>
                <div class="input-group" style="max-width: 200px;">
                    <input type="number" class="form-control" @bind="settings.DailyGoal" min="1" max="100" />
                    <span class="input-group-text">単語</span>
                </div>
                <small class="text-muted">つかさくん、まもるくんが一日で取り組む単語の数だよ。</small>
            </div>

            <button class="btn btn-primary" @onclick="SaveSettings">設定を保存</button>

            @if (showSuccess)
            {
                <span class="text-success ms-3">✅ 保存したよ！</span>
            }
        </div>
    </div>
</div>

@code {
    private AppSettings settings = new();
    private bool showSuccess = false;

    protected override async Task OnInitializedAsync()
    {
        // 保存されている設定があれば読み込む
        var saved = await Storage.LoadAsync<AppSettings>("AppSettings");
        if (saved != null) settings = saved;
    }

    private async Task SaveSettings()
    {
        await Storage.SaveAsync("AppSettings", settings);
        showSuccess = true;
        StateHasChanged();

        // 2秒後に「保存したよ」メッセージを消す
        await Task.Delay(2000);
        showSuccess = false;
        StateHasChanged();
    }
}