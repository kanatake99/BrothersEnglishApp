@page "/"
@inject UserContext Context
@inject NavigationManager Nav
@inject LocalStorageService Storage

<PageTitle>ホーム - 英単語アプリ</PageTitle>

<div class="container mt-4">
    @if (!Context.IsLoggedIn)
    {
        @* 念のためのガード。OnInitializedで飛ばすが、一瞬見えるのを防ぐ *@
        <div class="text-center mt-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2">ログイン画面へ いどう中...</p>
        </div>
    }
    else
    {
        @* --- ログイン済みの表示：ここがメインのHome --- *@
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold">こんにちは、@(Context.CurrentUser)くん！</h1>
            <p class="text-muted">今日も一緒にお勉強をしよう！</p>
        </div>

        @* メインメニュー（カード形式で押しやすく） *@
        <div class="row g-4 justify-content-center">
            <div class="col-6 col-md-4">
                <div class="card h-100 shadow-sm border-warning text-center p-3 btn btn-light" @onclick='() => Nav.NavigateTo("training")'>
                    <div class="display-3">📝</div>
                    <div class="card-body p-1">
                        <h5 class="card-title fw-bold">覚える</h5>
                        <p class="small text-muted mb-0">Training</p>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-4">
                <div class="card h-100 shadow-sm border-success text-center p-3 btn btn-light" @onclick='() => Nav.NavigateTo("study")'>
                    <div class="display-3">🏁</div>
                    <div class="card-body p-1">
                        <h5 class="card-title fw-bold">復習</h5>
                        <p class="small text-muted mb-0">Study</p>
                    </div>
                </div>
            </div>
        </div>

        @* --- カレンダーエリア（後で実装する場所） --- *@
        <div class="mt-5 p-4 bg-white rounded shadow-sm">
            <h4 class="border-bottom pb-2 mb-3">📅 カレンダー</h4>
            <div class="text-center py-5 text-muted border border-dashed rounded">
                ここにカレンダーが出るよ！<br />
                丸（○）や花丸（💮）を並べる準備中...
            </div>
        </div>

        @* ログアウトボタン（親切設計） *@
        <div class="text-center mt-5">
            <button class="btn btn-link text-secondary" @onclick="HandleLogout">
                べつの 人で ログインする
            </button>
        </div>
    }
</div>

@code {
    protected override void OnInitialized()
    {
        // ログインしていなければログイン画面へリダイレクト
        if (!Context.IsLoggedIn)
        {
            Nav.NavigateTo("login");
        }
    }

    private async Task HandleLogout()
    {
        await Context.LogoutAsync();
        Nav.NavigateTo("login");
    }
}