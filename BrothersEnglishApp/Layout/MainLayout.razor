@inherits LayoutComponentBase
@inject UserContext UserContext
@inject NavigationManager Nav

@if (_isInitialized)
{
    @if (UserContext.IsLoggedIn)
    {
        @* ログイン済み：通常のサイドバー付きレイアウト *@
        <div class="page">
            <div class="sidebar">
                <NavMenu />
            </div>
            <main>
                <article class="content px-4">
                    @Body
                </article>
            </main>
        </div>
    }
    else
    {
        @* 未ログイン：ログイン画面を表示 *@
        @* ここで「login」というページを表示するようにするよ *@
        <BrothersEnglishApp.Pages.Login />
    }
}

@code {
    private bool _isInitialized;

    protected override async Task OnInitializedAsync()
    {
        await UserContext.InitializeAsync();
        _isInitialized = true;

        // 自動転送はここでは「あえてしない」のがコツ！
        // ログインしていれば @Body が Home を表示してくれるからね。
    }
}